<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ë¯¸ìŠ¤í…Œ ì˜ˆì•½ ê´€ë¦¬</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', sans-serif;
            background: #f5f5f5;
            color: #333333;
            min-height: 100vh;
        }

        /* ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-box {
            background: #ffffff;
            padding: 50px 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h2 {
            margin-bottom: 10px;
            font-size: 1.8em;
            color: #333333;
        }

        .login-box .subtitle {
            color: #666666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .login-form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333333;
            font-size: 0.9em;
        }

        .login-form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .login-form-group input:focus {
            outline: none;
            border-color: #333333;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: #333333;
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .login-btn:hover {
            background: #000000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .login-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .login-error {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 15px;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        /* ë©”ì¸ ì»¨í…ì¸  (ë¡œê·¸ì¸ ì „ ìˆ¨ê¹€) */
        .admin-content {
            display: none;
        }

        .admin-content.show {
            display: block;
        }

        /* í—¤ë” */
        .header {
            background: #333333;
            color: #ffffff;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-info {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .logout-btn {
            padding: 8px 20px;
            background: transparent;
            color: #ffffff;
            border: 2px solid #ffffff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ffffff;
            color: #333333;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #666666;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: 700;
            color: #333333;
        }

        .stat-card.confirmed .number {
            color: #28a745;
        }

        .stat-card.cancelled .number {
            color: #dc3545;
        }

        /* í•„í„° */
        .filter-section {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .filter-section h3 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #333333;
        }

        .filter-btn {
            padding: 10px 20px;
            background: #333333;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: #000000;
        }

        .filter-btn.reset {
            background: #ffffff;
            color: #333333;
            border: 2px solid #333333;
        }

        /* ì˜ˆì•½ ì°¨ë‹¨ ê´€ë¦¬ */
        .block-section {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .block-section h3 {
            margin-bottom: 20px;
            font-size: 1.2em;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .block-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        .block-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .block-form h4 {
            margin-bottom: 15px;
            color: #333333;
        }

        .block-form-group {
            margin-bottom: 15px;
        }

        .block-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #666666;
            font-size: 0.9em;
        }

        .block-form-group input,
        .block-form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1em;
        }

        .block-form-group input:focus,
        .block-form-group select:focus {
            outline: none;
            border-color: #333333;
        }

        .block-add-btn {
            width: 100%;
            padding: 12px;
            background: #dc3545;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .block-add-btn:hover {
            background: #c82333;
        }

        .block-list h4 {
            margin-bottom: 15px;
            color: #333333;
        }

        .blocked-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .blocked-item.pending {
            background: #fffaf0;
            border: 1px solid #fbd38d;
        }

        .blocked-item.booked {
            background: #f0f0f0;
            border: 1px solid #cccccc;
        }

        .blocked-item-info {
            flex: 1;
        }

        .blocked-item-date {
            font-weight: 600;
            color: #333333;
        }

        .blocked-item-time {
            color: #dc3545;
            font-weight: 600;
            margin-left: 10px;
        }

        .blocked-item-reason {
            font-size: 0.85em;
            color: #666666;
            margin-top: 5px;
        }

        .unblock-btn {
            padding: 8px 15px;
            background: #28a745;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .unblock-btn:hover {
            background: #218838;
        }

        .no-blocks {
            text-align: center;
            padding: 30px;
            color: #999999;
        }

        .form-hint {
            display: block;
            margin-top: 5px;
            font-size: 0.8em;
            color: #888888;
        }

        .open-schedule {
            font-size: 0.85em;
            color: #007bff;
            margin-top: 5px;
        }

        .open-schedule-badge {
            display: inline-block;
            padding: 3px 8px;
            background: #e7f1ff;
            color: #0056b3;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        /* ì˜ˆì•½ ëª©ë¡ */
        .reservation-list {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .reservation-list h3 {
            padding: 20px;
            border-bottom: 2px solid #e0e0e0;
            font-size: 1.2em;
        }

        .reservation-table {
            width: 100%;
            border-collapse: collapse;
        }

        .reservation-table th,
        .reservation-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .reservation-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #666666;
            font-size: 0.9em;
        }

        .reservation-table tr:hover {
            background: #f8f9fa;
        }

        .reservation-table tr:last-child td {
            border-bottom: none;
        }

        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-badge.confirmed {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
            margin-right: 5px;
        }

        .action-btn.cancel {
            background: #dc3545;
            color: #ffffff;
        }

        .action-btn.cancel:hover {
            background: #c82333;
        }

        .action-btn.delete {
            background: #6c757d;
            color: #ffffff;
        }

        .action-btn.delete:hover {
            background: #545b62;
        }

        .action-btn.restore {
            background: #28a745;
            color: #ffffff;
        }

        .action-btn.restore:hover {
            background: #218838;
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999999;
        }

        .empty-state p {
            font-size: 1.1em;
        }

        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666666;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            margin-bottom: 20px;
        }

        .modal-info {
            margin-bottom: 20px;
        }

        .modal-info p {
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .modal-info strong {
            display: inline-block;
            width: 80px;
            color: #666666;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .modal-btn.confirm {
            background: #dc3545;
            color: #ffffff;
        }

        .modal-btn.close {
            background: #e0e0e0;
            color: #333333;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .header-right {
                flex-direction: column;
                gap: 10px;
            }

            .reservation-table {
                display: block;
                overflow-x: auto;
            }

            .filter-group {
                flex-direction: column;
            }

            .filter-group select,
            .filter-group input,
            .filter-btn {
                width: 100%;
            }

            .block-container {
                grid-template-columns: 1fr;
            }

            .login-box {
                margin: 20px;
                padding: 30px 25px;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <h2>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <p class="subtitle">íƒ€ë¯¸ìŠ¤í…Œ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            <div class="login-form-group">
                <label>ì•„ì´ë””</label>
                <input type="text" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
            </div>
            <div class="login-form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="handleLoginEnter(event)">
            </div>
            <button class="login-btn" id="loginBtn" onclick="attemptLogin()">ë¡œê·¸ì¸</button>
            <p class="login-error" id="loginError">ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ì»¨í…ì¸  -->
    <div class="admin-content" id="adminContent">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸ­ íƒ€ë¯¸ìŠ¤í…Œ ì˜ˆì•½ ê´€ë¦¬</h1>
            <div class="header-right">
                <div class="header-info">
                    <span id="currentDate"></span>
                </div>
                <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>

        <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
        <div class="container">
            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="stats-container">
                <div class="stat-card">
                    <h3>ì „ì²´ ì˜ˆì•½</h3>
                    <div class="number" id="totalCount">0</div>
                </div>
                <div class="stat-card confirmed">
                    <h3>í™•ì • ì˜ˆì•½</h3>
                    <div class="number" id="confirmedCount">0</div>
                </div>
                <div class="stat-card cancelled">
                    <h3>ì·¨ì†Œ ì˜ˆì•½</h3>
                    <div class="number" id="cancelledCount">0</div>
                </div>
            </div>

            <!-- ì˜ˆì•½ ì˜¤í”ˆ ê´€ë¦¬ -->
            <div class="block-section">
                <h3>ğŸ“… ì˜ˆì•½ ì˜¤í”ˆ ê´€ë¦¬</h3>
                <div class="block-container">
                    <div class="block-form">
                        <h4>ìƒˆ ì˜ˆì•½ ì˜¤í”ˆ</h4>
                        <div class="block-form-group">
                            <label>ë‚ ì§œ</label>
                            <input type="date" id="blockDate">
                        </div>
                        <div class="block-form-group">
                            <label>ì‹œê°„</label>
                            <select id="blockTime">
                                <option value="13:00">13:00</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                        <div class="block-form-group">
                            <label>ì˜ˆì•½ ì˜¤í”ˆ ì¼ì‹œ (ì„ íƒ)</label>
                            <input type="datetime-local" id="blockOpenAt">
                            <small class="form-hint">ì„¤ì •í•˜ë©´ í•´ë‹¹ ì‹œê°„ì— ì˜ˆì•½ì´ ì—´ë¦½ë‹ˆë‹¤. ë¯¸ì„¤ì • ì‹œ ì¦‰ì‹œ ì˜¤í”ˆ</small>
                        </div>
                        <div class="block-form-group">
                            <label>ë©”ëª¨ (ì„ íƒ)</label>
                            <input type="text" id="blockReason" placeholder="ì˜ˆ: 12ì›” ì²«ì§¸ì£¼ ê³µì—°">
                        </div>
                        <button class="block-add-btn" style="background: #28a745;" onclick="addAvailableSlot()">ì˜ˆì•½ ì˜¤í”ˆ</button>
                    </div>
                    <div class="block-list">
                        <h4>ì˜¤í”ˆëœ ì˜ˆì•½ ìŠ¬ë¡¯</h4>
                        <div id="blockedSlotsList">
                            <div class="loading">ì˜¤í”ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í•„í„° -->
            <div class="filter-section">
                <h3>ğŸ” í•„í„°</h3>
                <div class="filter-group">
                    <select id="statusFilter">
                        <option value="all">ì „ì²´ ìƒíƒœ</option>
                        <option value="confirmed">í™•ì •</option>
                        <option value="cancelled">ì·¨ì†Œ</option>
                    </select>
                    <select id="dateFilter">
                        <option value="all">ì „ì²´ ë‚ ì§œ</option>
                    </select>
                    <button class="filter-btn" onclick="applyFilter()">í•„í„° ì ìš©</button>
                    <button class="filter-btn reset" onclick="resetFilter()">ì´ˆê¸°í™”</button>
                </div>
            </div>

            <!-- ì˜ˆì•½ ëª©ë¡ -->
            <div class="reservation-list">
                <h3>ğŸ“‹ ì˜ˆì•½ ëª©ë¡</h3>
                <div id="reservationContent">
                    <div class="loading">ì˜ˆì•½ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì·¨ì†Œ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal" id="cancelModal">
        <div class="modal-content">
            <h3>âš ï¸ ì˜ˆì•½ ì·¨ì†Œ í™•ì¸</h3>
            <p style="margin-bottom: 20px;">ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-info" id="cancelModalInfo"></div>
            <div class="modal-buttons">
                <button class="modal-btn close" onclick="closeCancelModal()">ì•„ë‹ˆì˜¤</button>
                <button class="modal-btn confirm" id="confirmCancelBtn">ì˜ˆ, ì·¨ì†Œí•©ë‹ˆë‹¤</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyDEwIv6IFu0_Tg4OaYiUK5GWwpHqia6tlE",
            authDomain: "reservation-mind.firebaseapp.com",
            projectId: "reservation-mind",
            storageBucket: "reservation-mind.firebasestorage.app",
            messagingSenderId: "137392518118",
            appId: "1:137392518118:web:a33e8eaf4399b46e2b9c27"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let allReservations = [];
        let availableSlots = [];
        let bookedSlots = {};
        let currentFilter = { status: 'all', date: 'all' };
        let isLoggedIn = false;

        // SHA-256 í•´ì‹œ í•¨ìˆ˜
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // ì—”í„° í‚¤ë¡œ ë¡œê·¸ì¸
        function handleLoginEnter(event) {
            if (event.key === 'Enter') {
                attemptLogin();
            }
        }

        // ë¡œê·¸ì¸ ì‹œë„
        async function attemptLogin() {
            const loginId = document.getElementById('loginId').value.trim();
            const loginPw = document.getElementById('loginPw').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');

            if (!loginId || !loginPw) {
                loginError.textContent = 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                loginError.classList.add('show');
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            loginError.classList.remove('show');

            try {
                // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ
                const hashedPw = await sha256(loginPw);

                // Firestoreì—ì„œ ê´€ë¦¬ì ì •ë³´ í™•ì¸
                const adminDoc = await db.collection('tamiste_admin').doc('credentials').get();

                if (adminDoc.exists) {
                    const adminData = adminDoc.data();
                    
                    if (adminData.username === loginId && adminData.passwordHash === hashedPw) {
                        // ë¡œê·¸ì¸ ì„±ê³µ
                        loginSuccess();
                    } else {
                        // ë¡œê·¸ì¸ ì‹¤íŒ¨
                        loginError.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        loginError.classList.add('show');
                    }
                } else {
                    // ê´€ë¦¬ì ê³„ì •ì´ ì—†ìœ¼ë©´ ìƒì„± (ìµœì´ˆ ì„¤ì •)
                    // ë³´ì•ˆì„ ìœ„í•´ í•´ì‹œê°’ë§Œ ì €ì¥
                    await db.collection('tamiste_admin').doc('credentials').set({
                        username: 'lucian1213',
                        passwordHash: '22b9185905d21d8927f66e1f74da9474cc9edf45d6f3883c9d790a67023ce778'
                    });

                    // ë‹¤ì‹œ ë¡œê·¸ì¸ ì‹œë„
                    if (loginId === 'lucian1213' && hashedPw === '22b9185905d21d8927f66e1f74da9474cc9edf45d6f3883c9d790a67023ce778') {
                        loginSuccess();
                    } else {
                        loginError.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        loginError.classList.add('show');
                    }
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                loginError.textContent = 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                loginError.classList.add('show');
            }

            loginBtn.disabled = false;
            loginBtn.textContent = 'ë¡œê·¸ì¸';
        }

        // ë¡œê·¸ì¸ ì„±ê³µ
        function loginSuccess() {
            isLoggedIn = true;
            sessionStorage.setItem('tamiste_admin_logged_in', 'true');
            
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('adminContent').classList.add('show');
            
            // ë°ì´í„° ë¡œë“œ
            displayCurrentDate();
            loadReservations();
            loadAvailableSlots();
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                isLoggedIn = false;
                sessionStorage.removeItem('tamiste_admin_logged_in');
                
                document.getElementById('loginOverlay').classList.remove('hidden');
                document.getElementById('adminContent').classList.remove('show');
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('loginId').value = '';
                document.getElementById('loginPw').value = '';
                document.getElementById('loginError').classList.remove('show');
            }
        }

        // ì„¸ì…˜ ì²´í¬
        function checkSession() {
            if (sessionStorage.getItem('tamiste_admin_logged_in') === 'true') {
                loginSuccess();
            }
        }

        // í˜„ì¬ ë‚ ì§œ í‘œì‹œ
        function displayCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ko-KR', options);
        }

        // ì˜¤í”ˆëœ ìŠ¬ë¡¯ ì‹¤ì‹œê°„ ë¡œë“œ
        function loadAvailableSlots() {
            db.collection('tamiste_available_slots')
                .orderBy('dateKey', 'asc')
                .onSnapshot((snapshot) => {
                    availableSlots = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        data.id = doc.id;
                        availableSlots.push(data);
                    });
                    renderAvailableSlots();
                }, (error) => {
                    console.error("ì˜¤í”ˆ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:", error);
                });
        }

        // ì˜¤í”ˆ ëª©ë¡ ë Œë”ë§
        function renderAvailableSlots() {
            const container = document.getElementById('blockedSlotsList');
            const now = new Date();
            
            if (availableSlots.length === 0) {
                container.innerHTML = '<div class="no-blocks">ì˜¤í”ˆëœ ì˜ˆì•½ ìŠ¬ë¡¯ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '';
            availableSlots.forEach(slot => {
                // ì˜¤í”ˆ ì‹œê°„ ì²´í¬
                let openAtStr = '';
                let isPending = false;
                let isBooked = false;
                
                if (slot.openAt) {
                    const openAtDate = slot.openAt.toDate ? slot.openAt.toDate() : new Date(slot.openAt);
                    isPending = now < openAtDate;
                    openAtStr = openAtDate.toLocaleString('ko-KR');
                }

                // ì˜ˆì•½ ì—¬ë¶€ ì²´í¬
                const bookedTimes = bookedSlots[slot.dateKey] || [];
                isBooked = bookedTimes.includes(slot.time);

                let statusClass = '';
                let statusBadge = '';
                
                if (isBooked) {
                    statusClass = 'booked';
                    statusBadge = '<span class="open-schedule-badge" style="background: #e2e8f0; color: #4a5568;">ì˜ˆì•½ë¨</span>';
                } else if (isPending) {
                    statusClass = 'pending';
                    statusBadge = `<span class="open-schedule-badge" style="background: #fef3c7; color: #92400e;">â° ${openAtStr} ì˜¤í”ˆ ì˜ˆì •</span>`;
                } else {
                    statusBadge = '<span class="open-schedule-badge" style="background: #d4edda; color: #155724;">ì˜ˆì•½ ê°€ëŠ¥</span>';
                }

                html += `
                    <div class="blocked-item ${statusClass}">
                        <div class="blocked-item-info">
                            <span class="blocked-item-date">${formatDateKey(slot.dateKey)}</span>
                            <span class="blocked-item-time">${slot.time}</span>
                            ${statusBadge}
                            ${slot.memo ? `<div class="blocked-item-reason">ë©”ëª¨: ${slot.memo}</div>` : ''}
                        </div>
                        <button class="unblock-btn" style="background: #dc3545;" onclick="removeAvailableSlot('${slot.id}')">ì‚­ì œ</button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ì˜ˆì•½ ì˜¤í”ˆ ì¶”ê°€
        async function addAvailableSlot() {
            const dateInput = document.getElementById('blockDate').value;
            const time = document.getElementById('blockTime').value;
            const openAtInput = document.getElementById('blockOpenAt').value;
            const memo = document.getElementById('blockReason').value.trim();

            if (!dateInput) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë‚ ì§œë¥¼ dateKey í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (2025-12-6 í˜•ì‹)
            const dateParts = dateInput.split('-');
            const year = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]);
            const day = parseInt(dateParts[2]);
            const dateKey = `${year}-${month}-${day}`;

            // ì¤‘ë³µ ì²´í¬
            const existing = availableSlots.find(s => s.dateKey === dateKey && s.time === time);
            if (existing) {
                alert('ì´ë¯¸ ì˜¤í”ˆëœ ì‹œê°„ì…ë‹ˆë‹¤.');
                return;
            }

            try {
                const slotData = {
                    dateKey: dateKey,
                    time: time,
                    memo: memo,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // ì˜¤í”ˆ ì‹œê°„ì´ ì„¤ì •ëœ ê²½ìš°
                if (openAtInput) {
                    slotData.openAt = new Date(openAtInput);
                }

                await db.collection('tamiste_available_slots').add(slotData);

                alert('ì˜ˆì•½ì´ ì˜¤í”ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('blockDate').value = '';
                document.getElementById('blockOpenAt').value = '';
                document.getElementById('blockReason').value = '';

            } catch (error) {
                console.error('ì˜¤í”ˆ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('ì˜¤í”ˆ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜¤í”ˆ ìŠ¬ë¡¯ ì‚­ì œ
        async function removeAvailableSlot(id) {
            const slot = availableSlots.find(s => s.id === id);
            if (!slot) return;

            // ì˜ˆì•½ì´ ìˆëŠ”ì§€ í™•ì¸
            const bookedTimes = bookedSlots[slot.dateKey] || [];
            if (bookedTimes.includes(slot.time)) {
                alert('ì´ ì‹œê°„ì— ì˜ˆì•½ì´ ìˆìŠµë‹ˆë‹¤.\nì˜ˆì•½ì„ ë¨¼ì € ì·¨ì†Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!confirm('ì´ ì‹œê°„ì˜ ì˜ˆì•½ ì˜¤í”ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                await db.collection('tamiste_available_slots').doc(id).delete();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜ˆì•½ ë°ì´í„° ì‹¤ì‹œê°„ ë¡œë“œ
        function loadReservations() {
            db.collection('tamiste_reservations')
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    allReservations = [];
                    bookedSlots = {};
                    const dates = new Set();

                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        data.id = doc.id;
                        allReservations.push(data);
                        dates.add(data.dateKey);
                        
                        // bookedSlots ì—…ë°ì´íŠ¸ (í™•ì •ëœ ì˜ˆì•½ë§Œ)
                        if (data.status === 'confirmed') {
                            if (!bookedSlots[data.dateKey]) {
                                bookedSlots[data.dateKey] = [];
                            }
                            bookedSlots[data.dateKey].push(data.time);
                        }
                    });

                    // ë‚ ì§œ í•„í„° ì—…ë°ì´íŠ¸
                    updateDateFilter(dates);
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateStats();
                    
                    // ëª©ë¡ ë Œë”ë§
                    renderReservations();
                    
                    // ì˜¤í”ˆ ìŠ¬ë¡¯ ëª©ë¡ë„ ë‹¤ì‹œ ë Œë”ë§ (ì˜ˆì•½ ìƒíƒœ ë°˜ì˜)
                    renderAvailableSlots();
                }, (error) => {
                    console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error);
                    document.getElementById('reservationContent').innerHTML = 
                        '<div class="empty-state"><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p></div>';
                });
        }

        // ë‚ ì§œ í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateDateFilter(dates) {
            const dateFilter = document.getElementById('dateFilter');
            const currentValue = dateFilter.value;
            
            dateFilter.innerHTML = '<option value="all">ì „ì²´ ë‚ ì§œ</option>';
            
            const sortedDates = Array.from(dates).sort();
            sortedDates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = formatDateKey(date);
                dateFilter.appendChild(option);
            });

            dateFilter.value = currentValue;
        }

        // ë‚ ì§œ í‚¤ í¬ë§·íŒ…
        function formatDateKey(dateKey) {
            const parts = dateKey.split('-');
            return `${parts[0]}ë…„ ${parts[1]}ì›” ${parts[2]}ì¼`;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const total = allReservations.length;
            const confirmed = allReservations.filter(r => r.status === 'confirmed').length;
            const cancelled = allReservations.filter(r => r.status === 'cancelled').length;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('confirmedCount').textContent = confirmed;
            document.getElementById('cancelledCount').textContent = cancelled;
        }

        // í•„í„° ì ìš©
        function applyFilter() {
            currentFilter.status = document.getElementById('statusFilter').value;
            currentFilter.date = document.getElementById('dateFilter').value;
            renderReservations();
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilter() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('dateFilter').value = 'all';
            currentFilter = { status: 'all', date: 'all' };
            renderReservations();
        }

        // ì˜ˆì•½ ëª©ë¡ ë Œë”ë§
        function renderReservations() {
            let filtered = allReservations;

            // ìƒíƒœ í•„í„°
            if (currentFilter.status !== 'all') {
                filtered = filtered.filter(r => r.status === currentFilter.status);
            }

            // ë‚ ì§œ í•„í„°
            if (currentFilter.date !== 'all') {
                filtered = filtered.filter(r => r.dateKey === currentFilter.date);
            }

            const content = document.getElementById('reservationContent');

            if (filtered.length === 0) {
                content.innerHTML = '<div class="empty-state"><p>ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            let html = `
                <table class="reservation-table">
                    <thead>
                        <tr>
                            <th>ì˜ˆì•½ì¼</th>
                            <th>ì‹œê°„</th>
                            <th>ì´ë¦„</th>
                            <th>ì—°ë½ì²˜</th>
                            <th>ìƒíƒœ</th>
                            <th>ì˜ˆì•½ì‹œê°„</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filtered.forEach(reservation => {
                const statusClass = reservation.status === 'confirmed' ? 'confirmed' : 'cancelled';
                const statusText = reservation.status === 'confirmed' ? 'í™•ì •' : 'ì·¨ì†Œ';
                
                // ì˜ˆì•½ ìƒì„± ì‹œê°„
                let createdTime = '-';
                if (reservation.createdAt) {
                    const date = reservation.createdAt.toDate();
                    createdTime = date.toLocaleString('ko-KR');
                }

                html += `
                    <tr>
                        <td>${reservation.dateStr || formatDateKey(reservation.dateKey)}</td>
                        <td>${reservation.time}</td>
                        <td>${reservation.name}</td>
                        <td>${reservation.formattedPhone || reservation.phone}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${createdTime}</td>
                        <td>
                            ${reservation.status === 'confirmed' 
                                ? `<button class="action-btn cancel" onclick="showCancelModal('${reservation.id}')">ì·¨ì†Œ</button>`
                                : `<button class="action-btn restore" onclick="restoreReservation('${reservation.id}')">ë³µêµ¬</button>`
                            }
                            <button class="action-btn delete" onclick="deleteReservation('${reservation.id}')">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // ì·¨ì†Œ ëª¨ë‹¬ í‘œì‹œ
        function showCancelModal(id) {
            const reservation = allReservations.find(r => r.id === id);
            if (!reservation) return;

            const modalInfo = document.getElementById('cancelModalInfo');
            modalInfo.innerHTML = `
                <p><strong>ë‚ ì§œ:</strong> ${reservation.dateStr || formatDateKey(reservation.dateKey)}</p>
                <p><strong>ì‹œê°„:</strong> ${reservation.time}</p>
                <p><strong>ì´ë¦„:</strong> ${reservation.name}</p>
                <p><strong>ì—°ë½ì²˜:</strong> ${reservation.formattedPhone || reservation.phone}</p>
            `;

            document.getElementById('confirmCancelBtn').onclick = () => cancelReservation(id);
            document.getElementById('cancelModal').classList.add('active');
        }

        // ì·¨ì†Œ ëª¨ë‹¬ ë‹«ê¸°
        function closeCancelModal() {
            document.getElementById('cancelModal').classList.remove('active');
        }

        // ì˜ˆì•½ ì·¨ì†Œ
        async function cancelReservation(id) {
            try {
                await db.collection('tamiste_reservations').doc(id).update({
                    status: 'cancelled',
                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                closeCancelModal();
                alert('ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì·¨ì†Œ ì˜¤ë¥˜:', error);
                alert('ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜ˆì•½ ë³µêµ¬
        async function restoreReservation(id) {
            if (!confirm('ì´ ì˜ˆì•½ì„ ë‹¤ì‹œ í™•ì • ìƒíƒœë¡œ ë³µêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                await db.collection('tamiste_reservations').doc(id).update({
                    status: 'confirmed',
                    restoredAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert('ì˜ˆì•½ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë³µêµ¬ ì˜¤ë¥˜:', error);
                alert('ë³µêµ¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜ˆì•½ ì‚­ì œ
        async function deleteReservation(id) {
            if (!confirm('ì´ ì˜ˆì•½ì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;

            try {
                await db.collection('tamiste_reservations').doc(id).delete();
                alert('ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ˆê¸°í™” - ì„¸ì…˜ ì²´í¬
        checkSession();
    </script>
</body>
</html>
